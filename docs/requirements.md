# 요구사항정리
## API List
- [`잔액충전/조회`](#잔액충전조회)
- [`상품조회`](#상품조회)
- [`주문/결제`](#주문결제)
- [`선착순 쿠폰 발급`](#선착순-쿠폰-발급)
- [`인기 판매상품 조회`](#인기-판매상품-조회)
<br>

## 요구사항 및 개발 계획
### `잔액충전/조회`

**요구사항**<br>
- 결제에 사용될 금액을 충전하는 API
- 사용자 식별 및 충전할 금액을 받아 잔액을 충전
- 사용자 식별자를 통해 해당 사용자의 잔액을 조회

**계획**<br>
`userId`를 사용자 식별자로 이용해 충전, 잔액조회를 진행한다.
> 💡 사용자 식별을 할때 이 사람이 정확한 우리 사이트의 회원인지는 `프론트엔드`, `인증서버`에서 진행을 한다고 생각한다.<br>
> 그렇다면 이번 잔액충전의 경우 이미 인증을 완료한 사용자가 요청한 것으로 인지, <br>
> `userId`라는 간단한 식별자로 사용자를 확인해도 괜찮다고 생각한다.<br>

<br>

### `상품조회`

**요구사항**<br>
- 상품 정보 ( ID, 이름, 가격, 잔여수량 ) 을 조회하는 API
- 조회시점의 상품별 잔여수량이 정확해야함.

**계획**<br>
`productId`를 이용 상품의 정보를 조회한다.<br>
> 💡 상품정보 조회 시 동시성 문제를 해결하기 위해 `상품`과 `재고`를 분리하여 관리한다.<br>

<br>

### `주문/결제`

**요구사항**<br>
- 사용자 식별자와 (상품 ID, 수량) 목록을 입력받아 주문하고 결제를 수행하는 API
- 결제는 기 충전된 잔액을 기반으로 수행하며 성공할 시 잔액을 차감
- 데이터 분석을 위해 결제 성공 시에 실시간으로 주문 정보를 데이터 플랫폼에 전송

**계획**<br>
`주문`과 `결제`를 분리하여 개발을 진행한다.<br>
주문 flow<br>
재고차감(재고확인) -> 쿠폰차감(쿠폰확인) -> 주문서 생성 -> 결제 -> 결제이력저장 -> 주문완료 -> 데이터 플랫폼 전송 <br>
> 💡 주문 과 결제를 분리하는 이유는, 실제 서비스에서도 주문 후 결제를 다른 서비스로 넘겨 처리된다.<br>
> 따라서 우리 flow에서도 분리하여 진행한다.

<br>

### `선착순 쿠폰 발급`

**요구사항**<br>
- 선착순 쿠폰 발급 API 및 보유 쿠폰 목록 조회 API
- 사용자는 선착순으로 할인 쿠폰을 발급받을 수 있음
- 주문 시에 유효한 할인 쿠폰을 함께 제출하면, 전체 주문금액에 대해 할인 혜택을 부여받을 수 있음.

**계획**<br>
`쿠폰`발급의 경우 `쿠폰의 정의`에서 복재를 해서 가져가며 차감을 하는 방식으로 구현을 진행해 동시성 이슈를 해결한다.<br>
`쿠폰`사용의 경우 `주문`과 연관관계를 가지며 할인을 적용한다.<br>
`쿠폰`은 항상 만료기간을 가지고 있으면 기간이 만료되면 사용할 수 없다.

<br>

### `인기 판매상품 조회`

**요구사항**<br>
- 최근 3일간 가장 많이 팔린 상위 5개 상품 정보를 제공하는 API
- 통계 정보를 다루기 위한 기술적 고민 고려

**계획**<br>
`상품`의 판매를 기록하고 이걸 통계로 활용하기 위해 `상품`도메인에서 관리하는 것이 아닌 `상품판매`도메인에서 관리를 진행한다<br>